<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Bayesian Regression Models using BRMS | Bayesian Statistics for Linguists</title>
  <meta name="description" content="This is a set of statistical tools and code that I have found useful in my research." />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Bayesian Regression Models using BRMS | Bayesian Statistics for Linguists" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a set of statistical tools and code that I have found useful in my research." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Bayesian Regression Models using BRMS | Bayesian Statistics for Linguists" />
  
  <meta name="twitter:description" content="This is a set of statistical tools and code that I have found useful in my research." />
  

<meta name="author" content="Masoud Jasbi" />


<meta name="date" content="2019-07-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html">
<link rel="next" href="references.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Useful Stats for Linguists</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#what-is-the-difference-between-bayesian-and-frequentist-regression"><i class="fa fa-check"></i><b>1.1</b> What is the difference between Bayesian and Frequentist regression?</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#guidlines-for-random-effects-structure"><i class="fa fa-check"></i><b>1.2</b> Guidlines for Random Effects Structure</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="brms.html"><a href="brms.html"><i class="fa fa-check"></i><b>2</b> Bayesian Regression Models using BRMS</a><ul>
<li class="chapter" data-level="2.1" data-path="brms.html"><a href="brms.html#what-is-brms"><i class="fa fa-check"></i><b>2.1</b> What is BRMS?</a></li>
<li class="chapter" data-level="2.2" data-path="brms.html"><a href="brms.html#continuous-dv"><i class="fa fa-check"></i><b>2.2</b> Continuous DV</a><ul>
<li class="chapter" data-level="2.2.1" data-path="brms.html"><a href="brms.html#fixed-effects-model"><i class="fa fa-check"></i><b>2.2.1</b> Fixed-effects Model</a></li>
<li class="chapter" data-level="2.2.2" data-path="brms.html"><a href="brms.html#random-effects-models"><i class="fa fa-check"></i><b>2.2.2</b> Random Effects Models</a></li>
<li class="chapter" data-level="2.2.3" data-path="brms.html"><a href="brms.html#changing-priors"><i class="fa fa-check"></i><b>2.2.3</b> Changing Priors</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="brms.html"><a href="brms.html#categorical-dv"><i class="fa fa-check"></i><b>2.3</b> Categorical DV</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bayesian Statistics for Linguists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="brms" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Bayesian Regression Models using BRMS</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(lme4) <span class="co"># frequentist linear mixed-effects models</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">library</span>(brms) <span class="co"># Bayesian regression models</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">library</span>(HDInterval) <span class="co"># credible interval computation (highest posterier density)</span></a></code></pre></div>
<div id="what-is-brms" class="section level2">
<h2><span class="header-section-number">2.1</span> What is BRMS?</h2>
<p>BRMS is an R package for Bayesian statistical analysis developed by Paul Buerkner <span class="citation">(Bürkner and others <a href="#ref-burkner2017brms">2017</a>)</span>. It stands for Bayesian Regression Models using Stan. Stan is a probabilistic programming language developed by a team of programmers and statisticians headed by Andrew Gelman at Columbia University. It allows for developing Bayesian statistical models. BRMS provides an easy to use R interface to Stan so that instead of writing Stan code, we write our models in the familiar <code>lme4</code> langauge. BRMS translates our R code to Stan and brings back the results.</p>
</div>
<div id="continuous-dv" class="section level2">
<h2><span class="header-section-number">2.2</span> Continuous DV</h2>
<p>Main Questions:</p>
<ul>
<li>Does voice pitch differ across female and male speakers?</li>
<li>How much does it depend on the social context?</li>
</ul>
<p>We use the data provided by Franke and Roettger:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">politedata &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/michael-franke/bayes_mixed_regression_tutorial/master/code/politeness_data.csv&quot;</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">head</span>(politedata)</a></code></pre></div>
<pre><code>##   subject gender sentence context pitch
## 1      F1      F       S1     pol 213.3
## 2      F1      F       S1     inf 204.5
## 3      F1      F       S2     pol 285.1
## 4      F1      F       S2     inf 259.7
## 5      F1      F       S3     pol 203.9
## 6      F1      F       S3     inf 286.9</code></pre>
<p>Always a good idea to look at the summary of the data:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">summary</span>(politedata)</a></code></pre></div>
<pre><code>##  subject gender sentence context      pitch      
##  F1:14   F:42   S1:12    inf:42   Min.   : 82.2  
##  F2:14   M:41   S2:12    pol:41   1st Qu.:131.6  
##  F3:14          S3:12             Median :203.9  
##  M3:14          S4:12             Mean   :193.6  
##  M4:13          S5:12             3rd Qu.:248.6  
##  M7:14          S6:11             Max.   :306.8  
##                 S7:12</code></pre>
<p>Let’s plot the data:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">ggplot</span>(politedata, <span class="kw">aes</span>(gender, pitch, <span class="dt">fill=</span>context)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span><span class="co"># create boxplots</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">  </span><span class="kw">stat_summary</span>(<span class="dt">fun.y=</span>mean, </a>
<a class="sourceLine" id="cb6-4" data-line-number="4">               <span class="dt">geom=</span><span class="st">&quot;point&quot;</span>, </a>
<a class="sourceLine" id="cb6-5" data-line-number="5">               <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width=</span><span class="fl">0.75</span>), </a>
<a class="sourceLine" id="cb6-6" data-line-number="6">               <span class="dt">shape=</span><span class="dv">3</span>, </a>
<a class="sourceLine" id="cb6-7" data-line-number="7">               <span class="dt">size=</span><span class="dv">4</span>, </a>
<a class="sourceLine" id="cb6-8" data-line-number="8">               <span class="dt">color=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># add the mean value to the boxplot</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">color=</span><span class="st">&quot;grey&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># add invidual data points with jitter so that we can see them</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="st">  </span><span class="kw">theme_classic</span>()</a></code></pre></div>
<p><img src="mastats_files/figure-html/politdata_plot-1.png" width="672" /></p>
<p>We will consider 3 hypotheses:</p>
<ul>
<li><p><span class="math inline">\(H_1\)</span>: Female speakers have a lower average pitch in polite than in informal contexts.</p></li>
<li><p><span class="math inline">\(H_2\)</span>: Male speakers have a lower average pitch in polite than in informal contexts.</p></li>
<li><p><span class="math inline">\(H_3\)</span>: Male speakers have a lower average pitch in informal than female speakers have in polite contexts.</p></li>
</ul>
<div class="figure">
<img src="pics/table_mean_hypotheses_cropped.png" alt="Digram of the design and the hypotheses" />
<p class="caption">Digram of the design and the hypotheses</p>
</div>
<div id="fixed-effects-model" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Fixed-effects Model</h3>
<p>Let’s start with a simple fixed-effects frequentist regression model using the function <code>lm</code> in R.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">lme4Model_FE &lt;-<span class="st"> </span><span class="kw">lm</span>(pitch<span class="op">~</span><span class="st"> </span>gender <span class="op">*</span><span class="st"> </span>context, <span class="dt">data =</span> politedata)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="kw">summary</span>(lme4Model_FE)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = pitch ~ gender * context, data = politedata)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -78.486 -27.383  -0.986  20.570  96.020 
## 
## Coefficients:
##                    Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)         260.686      7.784  33.491   &lt;2e-16 ***
## genderM            -116.195     11.008 -10.556   &lt;2e-16 ***
## contextpol          -27.400     11.008  -2.489   0.0149 *  
## genderM:contextpol   15.890     15.664   1.014   0.3135    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 35.67 on 79 degrees of freedom
## Multiple R-squared:  0.7147, Adjusted R-squared:  0.7038 
## F-statistic: 65.95 on 3 and 79 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The model shows that pitch is significantly lower for male speakers in an informal context than female speakers in an informal context. A contrast we were not interested in. The model also shows that pitch is significantly lower in a polite context than informal context for female speakers. This is our first hypothesis (<span class="math inline">\(H_1\)</span>). Finally the model shows that there is no significant interaction between context and gender.</p>
<p>Let’s do the same thing the Bayesian way, using <code>brms</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># run regression model in brms</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">BaysModel_FE =<span class="st"> </span><span class="kw">brm</span>(</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">  <span class="dt">formula =</span> pitch <span class="op">~</span><span class="st"> </span>gender <span class="op">*</span><span class="st"> </span>context,</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">  <span class="dt">data =</span> politedata,</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">  <span class="dt">family =</span> <span class="st">&quot;gaussian&quot;</span>,</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">  <span class="dt">file =</span> <span class="st">&quot;models/BaysModel_FE&quot;</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb9-8" data-line-number="8"></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co"># print out model_FE summary</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10">BaysModel_FE</a></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: pitch ~ gender * context 
##    Data: politedata (Number of observations: 83) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##                    Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept            260.51      8.02   245.67   276.40       2358 1.00
## genderM             -116.03     11.35  -138.71   -94.06       2161 1.00
## contextpol           -27.27     11.38   -49.77    -5.01       2007 1.00
## genderM:contextpol    15.71     16.06   -15.72    47.53       1792 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma    36.15      2.96    30.81    42.67       3329 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>As you can see the results are very similar. With Bayesian models, it is important to look at the posterior distribution of our parameters, and most importantly, the trace plots of the chains to make sure they have converged.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">plot</span>(BaysModel_FE)</a></code></pre></div>
<p><img src="mastats_files/figure-html/tracePlots_PosteriorHistograms-1.png" width="672" /></p>
<p>We can also extract the posterior samples from our model:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># extract posterior samples</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">post_samples_FE &lt;-<span class="st"> </span><span class="kw">posterior_samples</span>(BaysModel_FE)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="kw">head</span>(post_samples_FE <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">1</span>))</a></code></pre></div>
<pre><code>##   b_Intercept b_genderM b_contextpol b_genderM:contextpol sigma   lp__
## 1       252.1    -110.3        -20.1                 19.5  37.0 -420.5
## 2       263.2    -119.7        -32.9                  6.7  34.4 -421.4
## 3       253.2    -104.7        -19.9                 17.2  33.7 -421.3
## 4       268.7    -120.6        -28.5                  5.5  31.4 -422.1
## 5       261.1    -116.6        -24.3                 11.9  32.7 -419.6
## 6       252.7    -123.5        -32.3                 32.2  32.9 -424.2</code></pre>
<p>Using posterior samples, we can estimate the probability of the hypotheses we are interested in. Let’s consider <span class="math inline">\(H_1\)</span>: Female speakers have a lower average pitch in polite than in informal contexts. Our model estimates female pitch in the informal context as its intercept (<span class="math inline">\(\beta_0\)</span>). It estimates female pitch in polite context as <span class="math inline">\(\beta_0 + \beta_{pol}\)</span>. Therefore, asking our model whether politeness lowers pitch in females is similar to asking if <span class="math inline">\(\beta_{pol}\)</span> is negative (<span class="math inline">\(b_{pol} &lt; 0\)</span>). We are not interested in a particular sample estimate but rather, across samples, how likely is that polite context has a negative contribution? (<span class="math inline">\(P(b_{polite} &lt; 0 | model, data)\)</span>). We can estimate the answer using the proportion of negative samples for the politeness parameter:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">mean</span>(post_samples_FE<span class="op">$</span>b_contextpol <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>)</a></code></pre></div>
<pre><code>## [1] 0.99225</code></pre>
<p>Now consider <span class="math inline">\(H_2\)</span>: Male speakers have a lower average pitch in polite than in informal contexts.</p>
<p>Consider <span class="math inline">\(H_3\)</span>: Male speakers have a lower average pitch in informal than female
speakers have in polite contexts. In our model, male pitch in informal contexts is <span class="math inline">\(\beta_{0}+ \beta_{male}\)</span> and female pitch in polite context was <span class="math inline">\(\beta_{} + \beta_{pol}\)</span>. Therefore, hypothesis 3 boils down to: <span class="math inline">\(\beta_{pol} &gt; \beta_{male}\)</span>? And of course we are not interested in one particular instance of it. We want to know how likely it is that <span class="math inline">\(H_3\)</span> is true. In other words, we are interested in <span class="math inline">\(P(\beta_{polite} &gt; \beta_{male})\)</span>. We can estimate this probability by computing the proportion of times that this inequality holds in the posterior samples:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">mean</span>(post_samples_FE<span class="op">$</span>b_contextpol <span class="op">&gt;</span><span class="st"> </span>post_samples_FE<span class="op">$</span>b_genderM)</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Michael Franke’s R package allows easy comparison between cells. First let’s install and load it:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">library</span>(devtools)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="co"># install package with convenience function for Bayesian regression models for factorial designs from GitHub</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="co">#install_github(</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="co">#  repo = &quot;michael-franke/bayes_mixed_regression_tutorial&quot;,</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6"><span class="co">#  subdir = &quot;faintr&quot;)</span></a>
<a class="sourceLine" id="cb18-7" data-line-number="7"></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="co"># load the just installed package</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="kw">library</span>(faintr)</a></code></pre></div>
<p>The function <code>compare_groups</code> takes predictor levels and returns their mean difference, the probability of their difference being more than 0, and its credible interval.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co"># compare cell means with each other</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="kw">compare_groups</span>(</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">  <span class="dt">model =</span> BaysModel_FE,</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">  <span class="dt">lower =</span> <span class="kw">list</span>(<span class="dt">gender =</span> <span class="st">&quot;M&quot;</span>, <span class="dt">context =</span> <span class="st">&quot;inf&quot;</span>),</a>
<a class="sourceLine" id="cb19-5" data-line-number="5">  <span class="dt">higher =</span> <span class="kw">list</span>(<span class="dt">gender =</span> <span class="st">&quot;F&quot;</span>, <span class="dt">context =</span> <span class="st">&quot;pol&quot;</span>)</a>
<a class="sourceLine" id="cb19-6" data-line-number="6">)</a></code></pre></div>
<pre><code>## Outcome of comparing groups:
##  * higher:  gender:F context:pol 
##  * lower:   gender:M context:inf 
## Mean &#39;higher - lower&#39;:  88.76 
## 95% CI: [ 66.84 ; 110.7 ]
## P(&#39;higher - lower&#39; &gt; 0):  1</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">get_posterior_beliefs_about_hypotheses =<span class="st"> </span><span class="cf">function</span>(model) {</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">  <span class="co"># insert the comparisons you are interested in as strings </span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3">  <span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">    <span class="dt">hypothesis =</span> <span class="kw">c</span>(<span class="st">&quot;Female-polite &lt; Female-informal&quot;</span>, </a>
<a class="sourceLine" id="cb21-5" data-line-number="5">                   <span class="st">&quot;Male-polite &lt; Male-informal&quot;</span>,</a>
<a class="sourceLine" id="cb21-6" data-line-number="6">                   <span class="st">&quot;Male-informal &lt; Female-polite&quot;</span>),</a>
<a class="sourceLine" id="cb21-7" data-line-number="7">    <span class="dt">probability =</span> <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb21-8" data-line-number="8">      <span class="co"># insert the comparisons you are interested in referring to the extracted samples</span></a>
<a class="sourceLine" id="cb21-9" data-line-number="9">      <span class="kw">compare_groups</span>(</a>
<a class="sourceLine" id="cb21-10" data-line-number="10">        <span class="dt">model =</span> model, </a>
<a class="sourceLine" id="cb21-11" data-line-number="11">        <span class="dt">lower =</span> <span class="kw">list</span>(<span class="dt">gender =</span> <span class="st">&quot;F&quot;</span>, <span class="dt">context =</span> <span class="st">&quot;pol&quot;</span>), </a>
<a class="sourceLine" id="cb21-12" data-line-number="12">        <span class="dt">higher =</span> <span class="kw">list</span>(<span class="dt">gender =</span> <span class="st">&quot;F&quot;</span>, <span class="dt">context =</span> <span class="st">&quot;inf&quot;</span>)</a>
<a class="sourceLine" id="cb21-13" data-line-number="13">      )<span class="op">$</span>probability,</a>
<a class="sourceLine" id="cb21-14" data-line-number="14">      <span class="kw">compare_groups</span>(</a>
<a class="sourceLine" id="cb21-15" data-line-number="15">        <span class="dt">model =</span> model, </a>
<a class="sourceLine" id="cb21-16" data-line-number="16">        <span class="dt">lower =</span> <span class="kw">list</span>(<span class="dt">gender =</span> <span class="st">&quot;M&quot;</span>, <span class="dt">context =</span> <span class="st">&quot;pol&quot;</span>), </a>
<a class="sourceLine" id="cb21-17" data-line-number="17">        <span class="dt">higher =</span> <span class="kw">list</span>(<span class="dt">gender =</span> <span class="st">&quot;M&quot;</span>, <span class="dt">context =</span> <span class="st">&quot;inf&quot;</span>)</a>
<a class="sourceLine" id="cb21-18" data-line-number="18">      )<span class="op">$</span>probability,</a>
<a class="sourceLine" id="cb21-19" data-line-number="19">      <span class="kw">compare_groups</span>(</a>
<a class="sourceLine" id="cb21-20" data-line-number="20">        <span class="dt">model =</span> model, </a>
<a class="sourceLine" id="cb21-21" data-line-number="21">        <span class="dt">lower =</span> <span class="kw">list</span>(<span class="dt">gender =</span> <span class="st">&quot;M&quot;</span>, <span class="dt">context =</span> <span class="st">&quot;inf&quot;</span>),</a>
<a class="sourceLine" id="cb21-22" data-line-number="22">        <span class="dt">higher =</span> <span class="kw">list</span>(<span class="dt">gender =</span> <span class="st">&quot;F&quot;</span>, <span class="dt">context =</span> <span class="st">&quot;pol&quot;</span>)</a>
<a class="sourceLine" id="cb21-23" data-line-number="23">      )<span class="op">$</span>probability </a>
<a class="sourceLine" id="cb21-24" data-line-number="24">    )</a>
<a class="sourceLine" id="cb21-25" data-line-number="25">  )</a>
<a class="sourceLine" id="cb21-26" data-line-number="26">}</a>
<a class="sourceLine" id="cb21-27" data-line-number="27"></a>
<a class="sourceLine" id="cb21-28" data-line-number="28"><span class="kw">get_posterior_beliefs_about_hypotheses</span>(BaysModel_FE)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   hypothesis                      probability
##   &lt;chr&gt;                                 &lt;dbl&gt;
## 1 Female-polite &lt; Female-informal       0.992
## 2 Male-polite &lt; Male-informal           0.845
## 3 Male-informal &lt; Female-polite         1</code></pre>
</div>
<div id="random-effects-models" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Random Effects Models</h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">lme4Model_RE &lt;-<span class="st"> </span><span class="kw">lmer</span>(pitch <span class="op">~</span><span class="st"> </span>gender<span class="op">*</span>context <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="st">                       </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>gender <span class="op">*</span><span class="st"> </span>context <span class="op">|</span><span class="st"> </span>sentence) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="st">                       </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>context<span class="op">|</span><span class="st"> </span>subject), </a>
<a class="sourceLine" id="cb23-4" data-line-number="4">                     <span class="dt">data =</span> politedata)</a></code></pre></div>
<pre><code>## boundary (singular) fit: see ?isSingular</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw">summary</span>(lme4Model_RE)</a></code></pre></div>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: pitch ~ gender * context + (1 + gender * context | sentence) +  
##     (1 + context | subject)
##    Data: politedata
## 
## REML criterion at convergence: 762.5
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -1.5177 -0.6585 -0.0512  0.5302  3.5188 
## 
## Random effects:
##  Groups   Name               Variance Std.Dev. Corr             
##  sentence (Intercept)        399.570  19.989                    
##           genderM            116.421  10.790   -0.97            
##           contextpol         217.655  14.753   -0.10 -0.05      
##           genderM:contextpol 293.247  17.124    0.12 -0.11 -0.78
##  subject  (Intercept)        599.757  24.490                    
##           contextpol           1.168   1.081   1.00             
##  Residual                    548.568  23.422                    
## Number of obs: 83, groups:  sentence, 7; subject, 6
## 
## Fixed effects:
##                    Estimate Std. Error t value
## (Intercept)          260.69      16.83  15.493
## genderM             -116.19      21.65  -5.367
## contextpol           -27.40       9.15  -2.994
## genderM:contextpol    15.89      12.20   1.303
## 
## Correlation of Fixed Effects:
##             (Intr) gendrM cntxtp
## genderM     -0.703              
## contextpol  -0.139  0.081       
## gndrM:cntxt  0.112 -0.142 -0.723
## convergence code: 0
## boundary (singular) fit: see ?isSingular</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw">isSingular</span>(lme4Model_RE)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">BaysModel_MaxRE &lt;-<span class="st"> </span><span class="kw">brm</span>(<span class="dt">formula =</span> pitch <span class="op">~</span><span class="st"> </span>gender <span class="op">*</span><span class="st"> </span>context <span class="op">+</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="st">                    </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>gender <span class="op">*</span><span class="st"> </span>context <span class="op">|</span><span class="st"> </span>sentence) <span class="op">+</span></a>
<a class="sourceLine" id="cb29-3" data-line-number="3"><span class="st">                    </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>context <span class="op">|</span><span class="st"> </span>subject),</a>
<a class="sourceLine" id="cb29-4" data-line-number="4">                  <span class="dt">data =</span> politedata,</a>
<a class="sourceLine" id="cb29-5" data-line-number="5">                  <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">0.99</span>),</a>
<a class="sourceLine" id="cb29-6" data-line-number="6">                  <span class="dt">file =</span> <span class="st">&quot;models/Baysmodel_MaxRE&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="co"># Extract posterior beliefs about our hypotheses</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="kw">get_posterior_beliefs_about_hypotheses</span>(BaysModel_MaxRE)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   hypothesis                      probability
##   &lt;chr&gt;                                 &lt;dbl&gt;
## 1 Female-polite &lt; Female-informal       0.981
## 2 Male-polite &lt; Male-informal           0.816
## 3 Male-informal &lt; Female-polite         0.990</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw">compare_groups</span>(</a>
<a class="sourceLine" id="cb32-2" data-line-number="2">  <span class="dt">model =</span> BaysModel_FE, </a>
<a class="sourceLine" id="cb32-3" data-line-number="3">  <span class="dt">lower =</span> <span class="kw">list</span>(<span class="dt">gender =</span> <span class="st">&quot;F&quot;</span>, <span class="dt">context =</span> <span class="st">&quot;pol&quot;</span>), </a>
<a class="sourceLine" id="cb32-4" data-line-number="4">  <span class="dt">higher =</span> <span class="kw">list</span>(<span class="dt">gender =</span> <span class="st">&quot;F&quot;</span>, <span class="dt">context =</span> <span class="st">&quot;inf&quot;</span>)</a>
<a class="sourceLine" id="cb32-5" data-line-number="5">)</a></code></pre></div>
<pre><code>## Outcome of comparing groups:
##  * higher:  gender:F context:inf 
##  * lower:   gender:F context:pol 
## Mean &#39;higher - lower&#39;:  27.27 
## 95% CI: [ 4.876 ; 49.64 ]
## P(&#39;higher - lower&#39; &gt; 0):  0.9922</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw">compare_groups</span>(</a>
<a class="sourceLine" id="cb34-2" data-line-number="2">  <span class="dt">model =</span> BaysModel_MaxRE, </a>
<a class="sourceLine" id="cb34-3" data-line-number="3">  <span class="dt">lower =</span> <span class="kw">list</span>(<span class="dt">gender =</span> <span class="st">&quot;M&quot;</span>, <span class="dt">context =</span> <span class="st">&quot;pol&quot;</span>), </a>
<a class="sourceLine" id="cb34-4" data-line-number="4">  <span class="dt">higher =</span> <span class="kw">list</span>(<span class="dt">gender =</span> <span class="st">&quot;M&quot;</span>, <span class="dt">context =</span> <span class="st">&quot;inf&quot;</span>)</a>
<a class="sourceLine" id="cb34-5" data-line-number="5">)</a></code></pre></div>
<pre><code>## Outcome of comparing groups:
##  * higher:  gender:M context:inf 
##  * lower:   gender:M context:pol 
## Mean &#39;higher - lower&#39;:  11.87 
## 95% CI: [ -18.05 ; 39.97 ]
## P(&#39;higher - lower&#39; &gt; 0):  0.8165</code></pre>
</div>
<div id="changing-priors" class="section level3">
<h3><span class="header-section-number">2.2.3</span> Changing Priors</h3>
<p>So far we have not explicitly provided priors for our models. <code>brms</code> has automatically assigned uninformed (uniform) priors. Let’s now add some information about model priors. First let’s see the priors for our fitted fixed-effects model:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="kw">prior_summary</span>(BaysModel_FE)</a></code></pre></div>
<pre><code>##                   prior     class               coef group resp dpar nlpar
## 1                               b                                         
## 2                               b         contextpol                      
## 3                               b            genderM                      
## 4                               b genderM:contextpol                      
## 5 student_t(3, 204, 83) Intercept                                         
## 6   student_t(3, 0, 83)     sigma                                         
##   bound
## 1      
## 2      
## 3      
## 4      
## 5      
## 6</code></pre>
<p>We can get all possible priors for our model before fitting it. Here <code>prior_summary</code> and <code>get_prior</code> give identical outputs because you have not specified any priors beyond the default priors:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1"><span class="kw">get_prior</span>(<span class="dt">formula =</span> pitch <span class="op">~</span><span class="st"> </span>gender <span class="op">*</span><span class="st"> </span>context,</a>
<a class="sourceLine" id="cb38-2" data-line-number="2">          <span class="dt">data =</span> politedata)</a></code></pre></div>
<pre><code>##                   prior     class               coef group resp dpar nlpar
## 1                               b                                         
## 2                               b         contextpol                      
## 3                               b            genderM                      
## 4                               b genderM:contextpol                      
## 5 student_t(3, 204, 83) Intercept                                         
## 6   student_t(3, 0, 83)     sigma                                         
##   bound
## 1      
## 2      
## 3      
## 4      
## 5      
## 6</code></pre>
<p>Let’s assume that polite context does not affect pitch in female speakers. We can assign a normal prior with the mean of 0:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">model_FE_prior =<span class="st"> </span><span class="kw">brm</span>(<span class="dt">formula =</span> pitch <span class="op">~</span><span class="st"> </span>gender <span class="op">*</span><span class="st"> </span>context,</a>
<a class="sourceLine" id="cb40-2" data-line-number="2">                     <span class="dt">prior =</span> <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb40-3" data-line-number="3">                       <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">coef =</span> contextpol)</a>
<a class="sourceLine" id="cb40-4" data-line-number="4">                       ),</a>
<a class="sourceLine" id="cb40-5" data-line-number="5">                     <span class="dt">data =</span> politedata,</a>
<a class="sourceLine" id="cb40-6" data-line-number="6">                     <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">0.99</span>),</a>
<a class="sourceLine" id="cb40-7" data-line-number="7">                     <span class="dt">file =</span> <span class="st">&quot;models/model_FE_prior&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw">get_posterior_beliefs_about_hypotheses</span>(model_FE_prior)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   hypothesis                      probability
##   &lt;chr&gt;                                 &lt;dbl&gt;
## 1 Female-polite &lt; Female-informal       0.946
## 2 Male-polite &lt; Male-informal           0.844
## 3 Male-informal &lt; Female-polite         1</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="co"># run model without considering gender</span></a>
<a class="sourceLine" id="cb43-2" data-line-number="2">model_FE_noGender &lt;-<span class="st"> </span><span class="kw">brm</span>(<span class="dt">formula =</span>  pitch <span class="op">~</span><span class="st"> </span>context,</a>
<a class="sourceLine" id="cb43-3" data-line-number="3">                        <span class="dt">data =</span> politedata,</a>
<a class="sourceLine" id="cb43-4" data-line-number="4">                        <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">0.99</span>),</a>
<a class="sourceLine" id="cb43-5" data-line-number="5">                        <span class="dt">file=</span><span class="st">&quot;models/model_FE_noGender&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="co"># perform posterior predictive check fo both models</span></a>
<a class="sourceLine" id="cb44-2" data-line-number="2"><span class="kw">pp_check</span>(model_FE_noGender, <span class="dt">nsample =</span> <span class="dv">100</span>)</a></code></pre></div>
<p><img src="mastats_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="kw">pp_check</span>(BaysModel_FE, <span class="dt">nsample =</span> <span class="dv">100</span>) </a></code></pre></div>
<p><img src="mastats_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
</div>
</div>
<div id="categorical-dv" class="section level2">
<h2><span class="header-section-number">2.3</span> Categorical DV</h2>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-burkner2017brms">
<p>Bürkner, Paul-Christian, and others. 2017. “Brms: An R Package for Bayesian Multilevel Models Using Stan.” <em>Journal of Statistical Software</em> 80 (1). Foundation for Open Access Statistics: 1–28.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["mastats.pdf", "mastats.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
